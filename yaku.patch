--- a/src/yaku.rs
+++ b/src/yaku.rs
@@ -40,15 +40,24 @@
     Chinitsu,         // Full flush (one suit only)
     
     // === Yakuman (limit hands) ===
-    Tenhou,           // Dealer wins on initial deal
-    Chiihou,          // Non-dealer wins on first draw
-    KokushiMusou,     // Thirteen orphans
-    Suuankou,         // Four concealed triplets
-    Daisangen,        // Big three dragons
-    Shousuushii,      // Little four winds
-    Daisuushii,       // Big four winds
-    Tsuuiisou,        // All honors
-    Chinroutou,       // All terminals
-    Ryuuiisou,        // All green
-    ChuurenPoutou,    // Nine gates
+    Tenhou,           // Dealer wins on initial deal
+    Chiihou,          // Non-dealer wins on first draw
+    KokushiMusou,     // Thirteen orphans
+    Suuankou,         // Four concealed triplets
+    Daisangen,        // Big three dragons
+    Shousuushii,      // Little four winds
+    Daisuushii,       // Big four winds
+    Tsuuiisou,        // All honors
+    Chinroutou,       // All terminals
+    Ryuuiisou,        // All green
+    ChuurenPoutou,    // Nine gates
     
     // === Double Yakuman ===
-    Kokushi13Wait,       // Kokushi with 13-sided wait
-    SuuankouTanki,       // Suuankou with tanki wait
-    JunseiChuurenPoutou, // Pure nine gates (9-sided wait)
+    Kokushi13Wait,       // Kokushi with 13-sided wait
+    SuuankouTanki,       // Suuankou with tanki wait
+    JunseiChuurenPoutou, // Pure nine gates (9-sided wait)
 }
 
 impl Yaku {
@@ -165,11 +174,13 @@
     // === Structure-based Yakuman ===
     match structure {
         HandStructure::Kokushi { pair } => {
-            // Check for 13-wait (double yakuman)
             if let Some(winning_tile) = context.winning_tile {
-                // 13-wait means the winning tile is NOT the pair
-                // (if pair == winning_tile, it was tanki on the pair)
                 if winning_tile != *pair {
+                    // 13-wait means the winning tile is NOT the pair
+                    yaku_list.push(Yaku::Kokushi13Wait);
                 } else {
+                    // If pair == winning_tile, it was tanki on the pair
                     yaku_list.push(Yaku::KokushiMusou);
                 }
             } else {
@@ -285,14 +296,23 @@
                     yaku_list.push(Yaku::Chanta);
                 }
                 
-                // San Ankou (three concealed triplets) - simplified: all triplets when closed + tsumo
-                if !is_open && context.win_type == WinType::Tsumo {
-                    let triplet_count = melds.iter()
-                        .filter(|m| matches!(m, Meld::Koutsu(_)))
-                        .count();
-                    if triplet_count >= 3 {
-                        yaku_list.push(Yaku::SanAnkou);
+                // San Ankou (three concealed triplets)
+                if !is_open {
+                    let mut concealed_triplets = 0;
+                    for meld in melds {
+                        if let Meld::Koutsu(tile) = meld {
+                            // A triplet is concealed if:
+                            // 1. It was won by Tsumo (self-draw).
+                            // 2. It was won by Ron, but the winning tile did NOT complete this triplet.
+                            if context.win_type == WinType::Tsumo {
+                                concealed_triplets += 1;
+                            } else if let Some(wt) = context.winning_tile {
+                                if *tile != wt {
+                                    concealed_triplets += 1;
+                                }
+                            }
+                        }
                     }
+                    if concealed_triplets == 3 {
+                        yaku_list.push(Yaku::SanAnkou);
+                    }
                 }
                 
                 // Honroutou (all terminals and honors)
@@ -628,4 +648,31 @@
         assert!(!has_yaku(&results, Yaku::Pinfu), "No winning tile = no pinfu detection");
     }
+
+    #[test]
+    fn test_san_ankou_ron_invalidation() {
+        // Hand: 111m 222p 333s 456s 77z
+        let hand_str = "111m222p333s456s77z";
+        let winning_tile = Tile::suited(Suit::Sou, 3);
+        
+        // 1. Tsumo Case - All triplets remain concealed
+        let context_tsumo = GameContext::new(WinType::Tsumo, Honor::East, Honor::East)
+            .with_winning_tile(winning_tile);
+        let results_tsumo = get_yaku_with_context(hand_str, &context_tsumo);
+        assert!(has_yaku(&results_tsumo, Yaku::SanAnkou));
+
+        // 2. Ron Case (Completing triplet) - The 333s triplet is now "open"
+        let context_ron = GameContext::new(WinType::Ron, Honor::East, Honor::East)
+            .with_winning_tile(winning_tile);
+        let results_ron = get_yaku_with_context(hand_str, &context_ron);
+        assert!(!has_yaku(&results_ron, Yaku::SanAnkou));
+
+        // 3. Ron Case (Tanki wait on pair) - All three triplets stay concealed
+        let pair_tile = Tile::honor(Honor::Red); 
+        let context_tanki = GameContext::new(WinType::Ron, Honor::East, Honor::East)
+            .with_winning_tile(pair_tile);
+        let results_tanki = get_yaku_with_context(hand_str, &context_tanki);
+        assert!(has_yaku(&results_tanki, Yaku::SanAnkou));
+    }
 }
 
